@using Sheltos.ViewModel
@model PropertyDetailViewModel
@{
    Layout = "_Layout2";
}
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Sheltos - Image box property details page">
    <meta name="keywords" content="sheltos">
    <meta name="author" content="sheltos">
    <link rel="icon" href="~/assets/images/favicon.png" type="image/x-icon" />
    <title>Sheltos - Image box property details page</title>

    <!--Google font-->
    <link href="https://fonts.googleapis.com/css?family=Montserrat:400,400i,500,500i,600,600i,700,700i,800,800i"
          rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Roboto:400,400i,500,500i,700,700i&amp;display=swap"
          rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Rubik:400,400i,500,500i,700,700i" rel="stylesheet">

    <!-- magnific css -->
    <link rel="stylesheet" type="text/css" href="~/assets/css/magnific-popup.css">

    <!-- range slider css -->
    <link rel="stylesheet" type="text/css" href="~/assets/css/jquery-ui.css">

    <!-- animate css -->
    <link rel="stylesheet" type="text/css" href="~/assets/css/animate.css">

    <!-- Template css -->
    <link rel="stylesheet" type="text/css" href="~/assets/css/bootstrap.css">
    <link rel="stylesheet" type="text/css" href="~/assets/css/color1.css">

</head>


<body>
   <!-- Loader start -->
    <div class="loader-wrapper">
        <div class="row loader-img">
            <div class="col-12">
                <img src="~/assets/images/loader/loader-2.gif" class="img-fluid" alt="">
            </div>
        </div>
    </div>
    <!-- Loader end -->
   
<!-- slider section start -->
<style>
    .property-image-grid {
        display: flex;
        flex-wrap: wrap;
        height: 500px;
        overflow: hidden;
    }

    .left-large {
        flex: 0 0 50%;
        height: 100%;
        padding: 2px;
    }

        .left-large img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

    .right-stack {
        flex: 0 0 25%;
        display: flex;
        flex-direction: column;
        padding: 2px;
    }

        .right-stack a {
            flex: 1;
            padding: 2px;
        }

        .right-stack img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
</style>
    <section class="p-0 ratio3_2">
        <div class="container-fluid">
            <div class="zoom-image-box zoom-gallery-multiple">
                <div class="container-fluid p-0">
                    <div class="property-image-grid">

                        <!-- Large Left Image -->
                        @if (Model.Property.GalleryImages.Count > 0)
                        {
                            <div class="left-large">
                                <a href="@Model.Property.GalleryImages[0]">
                                    <img src="@Model.Property.GalleryImages[0]" alt="Main Image" />
                                </a>
                            </div>
                        }

                        <!-- Right stack 1 (Image 2 and 3) -->
                        <div class="right-stack">
                            @if (Model.Property.GalleryImages.Count > 1)
                            {
                                <a href="@Model.Property.GalleryImages[1]">
                                    <img src="@Model.Property.GalleryImages[1]" alt="Image 2" />
                                </a>
                            }
                            @if (Model.Property.GalleryImages.Count > 2)
                            {
                                <a href="@Model.Property.GalleryImages[2]">
                                    <img src="@Model.Property.GalleryImages[2]" alt="Image 3" />
                                </a>
                            }
                        </div>

                        <!-- Right stack 2 (Image 4 and 5) -->
                        <div class="right-stack">
                            @if (Model.Property.GalleryImages.Count > 3)
                            {
                                <a href="@Model.Property.GalleryImages[3]">
                                    <img src="@Model.Property.GalleryImages[3]" alt="Image 4" />
                                </a>
                            }
                            @if (Model.Property.GalleryImages.Count > 4)
                            {
                                <a href="@Model.Property.GalleryImages[4]">
                                    <img src="@Model.Property.GalleryImages[4]" alt="Image 5" />
                                </a>
                            }
                        </div>

                    </div>
                </div>
            </div>
        </div>
    </section>


    <!-- slider section end -->

    <!-- single property header start -->
    <section class="without-top property-main small-section">
        <div class="single-property-section ">
            <div class="container">
                <div class="single-title">
                    <div class="left-single">
                        <div class="d-flex">
                            <h2 class="mb-0">@Model.Property.Title</h2>
                            <span><span class="label label-shadow ms-2">@Model.Property.PropertyStatus
                                    </span></span>
                        </div>
                        <p class="mt-1"
                       @($"{Model.Property.City}, {Model.Property.State}, {Model.Property.Country}") </p>
                        <ul>
                            <li>
                                <div>
                                    <img src="https://themes.pixelstrap.com/sheltos/assets/images/svg/icon/double-bed.svg" class="img-fluid" alt="">
                                    <span>@Model.Property.Beds Bedrooms</span>
                                </div>
                            </li>
                            <li>
                                <div>
                                    <img src="https://themes.pixelstrap.com/sheltos/assets/images/svg/icon/bathroom.svg" class="img-fluid" alt="">
                                    <span>@Model.Property.Bathrooms Bathrooms</span>
                                </div>
                            </li>
                            
                            <li>
                                <div>
                                    <img src="https://themes.pixelstrap.com/sheltos/assets/images/svg/icon/square-ruler-tool.svg" class="img-fluid ruler-tool" alt="">
                                    <span>@Model.Property.PropertySize Sq ft</span>
                                </div>
                            </li>
                            
                        </ul>
                    </div>
                    <div class="right-single">
                        <div class="rating">
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <i class="far fa-star"></i>
                        </div>
					<h2 class="price">@Model.Property.Price.ToString("C")</h2>

                    </div>
                </div>
            </div>
        </div>
    </section>
    <!-- single property header end -->

    <!-- single property start -->
    <section class="single-property mt-0 pt-0">
        <div class="container">
            <div class="row ratio_55">
                <div class="col-xl-9 col-lg-8">
                    <div class="description-section tab-description">
                        <div class="description-details">
                            <div class="desc-box">
                                <ul class="nav nav-tabs line-tab" id="top-tab" role="tablist">
                                    <li class="nav-item"><a data-bs-toggle="tab" class="nav-link active"
                                        href="#about">about</a></li>
                                    <li class="nav-item"><a data-bs-toggle="tab" class="nav-link"
                                        href="#feature">features</a></li>
                                </ul>
                                <div class=" tab-content" id="top-tabContent">
                                    <div class="tab-pane fade show active about page-section" id="about">
                                        <h4 class="content-title">Property Details
                                            <a href=""></a>
                                          

                                        </h4>
                                        <div class="row">
                                            <div class="col-md-6 col-xl-4">
                                                <ul class="property-list-details">
                                                    <li><span>Property Type :</span> @Model.Property.Type</li>
                                                    <li><span>Property ID :</span> @Model.Property.Id</li>
                                                    <li><span>Property status :</span>@Model.Property.PropertyStatus</li>
                                                    <li><span>Operating Since :</span>@Model.Property.DateTime</li>
                                                </ul>
                                            </div>
                                            <div class="col-md-6 col-xl-4">
                                                <ul class="property-list-details">
                                                    <li><span>Price :</span>@Model.Property.Price</li>
                                                    <li><span>Property Size :</span> @Model.Property.PropertySize sq / ft</li>
                                                   
                                                </ul>
                                            </div>
                                            <div class="col-md-6 col-xl-4">
                                                <ul class="property-list-details">
                                                    <li><span>City :</span> @Model.Property.City</li>
                                                    <li><span>Bedrooms :</span>@Model.Property.Beds</li>
                                                    <li><span>Bathrooms :</span> @Model.Property.Bathrooms</li>
                                                </ul>
                                            </div>
                                        </div>
                                        <h4 class="content-title mt-4"></h4>
                                        <a href="javascript:void(0)" class="attach-file">
                                        </a>
                                        <h4 class="mt-4">Property Brief</h4>
                                        <div class="row">
                                            <div class="col-sm-8">
                                                <p class="font-roboto">@Model.Property.Description</p>
                                            </div>
                                            
                                        </div>
                                    </div>
                                    <div class="tab-pane fade page-section" id="feature">
                                        <h4 class="content-title">features</h4>
                                        <div class="single-feature row">
                                            <div class="col-xl-3 col-6">
                                                <ul>
                                                   @foreach(var feature in Model.Property.Features)
                                                   {
                                                       <li>
                                                           <i class="fas fa-check"></i> @feature
                                                       </li>
												   }
                                                </ul>
                                            </div>
                                        </div>
                                    </div>
                                    

                                </div>
                            </div>
                            <div class="desc-box">
                                <div class="page-section">
                                    <h4 class="content-title">Reviews</h4>
                                    <div class="review">
                                        @if (Model.Review != null && Model.Review.Any())
                                        {
                                            @foreach (var review in Model.Review)
                                            {
                                                <div class="review-box">
                                                    <div class="media">
                                                        <img src="@review.User.ProfileImageUrl" class="img-70" alt="">
                                                        <div class="media-body">
                                                            <h6>@review.User.FullName</h6>
                                                            <p>@review.DateTime.ToString("dd/MM/yyyy")</p>
                                                            <p class="mb-0">@review.Comment</p>
                                                        </div>
                                                        <div class="rating">
                                                            <a asp-action="Delete" asp-controller="Property" asp-route-reviewId="@review.Id" asp-route-propertyId="@review.PropertyId">
                                                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" color="orange" class="bi bi-trash3" viewBox="0 0 16 16">
                                                                    <path d="M6.5 1h3a.5.5 0 0 1 .5.5v1H6v-1a.5.5 0 0 1 .5-.5M11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3A1.5 1.5 0 0 0 5 1.5v1H1.5a.5.5 0 0 0 0 1h.538l.853 10.66A2 2 0 0 0 4.885 16h6.23a2 2 0 0 0 1.994-1.84l.853-10.66h.538a.5.5 0 0 0 0-1zm1.958 1-.846 10.58a1 1 0 0 1-.997.92h-6.23a1 1 0 0 1-.997-.92L3.042 3.5zm-7.487 1a.5.5 0 0 1 .528.47l.5 8.5a.5.5 0 0 1-.998.06L5 5.03a.5.5 0 0 1 .47-.53Zm5.058 0a.5.5 0 0 1 .47.53l-.5 8.5a.5.5 0 1 1-.998-.06l.5-8.5a.5.5 0 0 1 .528-.47M8 4.5a.5.5 0 0 1 .5.5v8.5a.5.5 0 0 1-1 0V5a.5.5 0 0 1 .5-.5" />
                                                                </svg>
                                                            </a>
                                                           
                                                        </div>
                                                    </div>
                                                </div>
                                            }
                                        }
                                        else
                                        {
                                            <h6>No Comments Available</h6>
                                        }
                                    </div>
                                    
                                    <hr />
                                    <h4 class="content-title">Write a Review</h4>
                                    <form class="review-form" asp-action="AddReview" method="post">
										<input type="hidden" asp-for="Reviewinput.PropertyId" value="@Model.Property.Id" />
                                        <div class="form-group">
                                            <textarea class="form-control" asp-for="Reviewinput.Comment" placeholder="Comment"></textarea>
                                        </div>
                                        <button type="submit"  class="btn btn-gradient color-2 btn-pill">Submit</button>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="property-section p-t-40">
                        <div class="title-3 text-start inner-title">
                            <h2>Related Properties</h2>
                        </div>
                        <div class="row ratio_65">
                            <div class="col-12 property-grid-2">
                                <div class="property-2 row column-sm zoom-gallery property-label property-grid">
                                    @foreach (var item in Model.RelatedProperties)
                                    {
                                        <div class="col-md-6">
                                            <div class="property-box">

                                                <div class="property-image">
                                                    <div class="property-slider">
                                                        @foreach (var image in item.GalleryImages)
                                                        {
                                                            <a href="javascript:void(0)">
                                                                <img src="@image" class="bg-img" alt="Propertyimage">
                                                            </a>

                                                        }
                                                    </div>
                                                    <div class="labels-left">
                                                        <div>
                                                            <span class="label label-shadow">@item.PropertyStatus</span>
                                                        </div>
                                                    </div>

                                                    <div class="overlay-property-box">
                                                        <a href="user-favourites.html" class="effect-round like" data-bs-toggle="tooltip" data-bs-placement="left" title="wishlist">
                                                            <i data-feather="heart"></i>
                                                        </a>
                                                    </div>
                                                </div>
                                                <div class="property-details">
                                                    <span class="font-roboto">@($"{item.City}, {item.State}, {item.Country}")</span>
                                                    <a asp-controller="Property" asp-action="Details" asp-route-id="@item.Id">
                                                        <h3>@item.Title</h3>
                                                    </a>
                                                    <h6>@item.Price.ToString("C")</h6>
                                                    <p class="font-roboto">@item.Description</p>
                                                    <ul>
                                                        <li><img src="https://themes.pixelstrap.com/sheltos/assets/images/svg/icon/double-bed.svg" class="img-fluid" alt="">Bed : @item.Beds</li>
                                                        <li><img src="https://themes.pixelstrap.com/sheltos/assets/images/svg/icon/bathroom.svg" class="img-fluid" alt="">Baths : @item.Bathrooms</li>
                                                        <li><img src="https://themes.pixelstrap.com/sheltos/assets/images/svg/icon/square-ruler-tool.svg" class="img-fluid ruler-tool" alt="">Sq Ft : @item.PropertySize</li>
                                                    </ul>
                                                    <h5>@item.DateTime</h5>
                                                    <div class="property-btn d-flex">
                                                        <a asp-controller="Property" asp-action="Details" asp-route-id="@item.Id" class="btn btn-secondary">Details</a>
                                                        <a class="btn btn-secondary" asp-controller="ShoppingCart" asp-route-id="@item.Id" asp-action="AddToShoppingCart">Add To Cart</a>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    }
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-xl-3 col-lg-4">
                    <div class="left-sidebar sticky-cls single-sidebar">
                        <div class="filter-cards">
                            <div class="advance-card">
                                <h6>Contact Info</h6>
                                <div class="category-property">
                                    <div class="agent-info">
                                        <div class="media">
                                            <img src="@Model.Property.Image" class="img-50" alt="">
                                            <div class="media-body ms-2">
                                                <h6>@Model.Property.AgentName</h6>
                                               
                                            </div>
                                        </div>
                                    </div>
                                    <ul>
                                        <li>
                                            <p>@Model.Property.Email</p>
                                        </li>
                                        <li>
											<i data-feather="map-pin" class="me-2"></i>@Model.Property.Address
                                        </li>
                                        <li>
                                            <a href="tel:@Model.Property.PhoneNumber" class="d-flex align-items-center">
                                                <img src="https://img.icons8.com/color/48/phone.png" style="width: 25px; margin-right: 5px;" />
												@Model.Property.PhoneNumber
                                            </a>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                            <div class="advance-card">
                                <h6>Request Inquiry</h6>
                                <div class="category-property">
                                    <form asp-action="RequestProperty" asp-controller="Property" method="post">
                                        <input type="hidden" asp-for="@Model.PropertyRequest.PropertyId" value="@Model.Property.Id" />
                                        <div class="form-group">
                                            <input type="text" class="form-control" asp-for="@Model.PropertyRequest.Name" placeholder="Your Name" required>
                                        </div>
                                        <div class="form-group">
                                            <input type="email" class="form-control" asp-for="@Model.PropertyRequest.Email" placeholder="Email Address" required>
                                        </div>
                                        <div class="form-group">
                                            <input asp-for="@Model.PropertyRequest.PhoneNumber"
                                            placeholder="phone number"
                                            class="form-control" 
                                            
                                            id="tbNumbers" 
                                            oninput="maxLengthCheck(this)"
                                            type = "tel"
                                            onkeypress="javascript:return isNumber(event)"
                                            maxlength = "11"
                                            required="">
                                        </div>
                                        <div class="form-group">
                                            <textarea placeholder="Message" asp-for="@Model.PropertyRequest.Subject" class="form-control" rows="3"></textarea>
                                        </div>
                                        <button type="submit" class="btn btn-gradient color-2 btn-block btn-pill">Submit Request</button>
                                    </form>
                                </div>
                            </div>

                        </div>
                    </div>
                </div>

            </div>
        </div>
    </section>
<!-- latest jquery-->
<script src="~/assets/js/jquery-3.6.0.min.js"></script>

<!-- popper js-->
<script src="~/assets/js/popper.min.js"></script>
<script>
     // Remove any extra buttons under the chat box
    const suspiciousButtons = document.querySelectorAll(".btn, .btn-gradient");
     suspiciousButtons.forEach(btn => {
     if (btn.textContent.trim() === "") {
      btn.remove();
     }
    });
</script>


<!-- magnific js -->
<script src="~/assets/js/jquery.magnific-popup.js"></script>
<script src="~/assets/js/zoom-gallery.js"></script>
<script src="~/assets/js/zoom-gallery-multiple.js"></script>

<!-- Bootstrap js-->
<script src="~/assets/js/bootstrap.bundle.min.js"></script>

<!-- feather icon js-->
<script src="~/assets/js/feather-icon/feather.min.js"></script>
<script src="~/assets/js/feather-icon/feather-icon.js"></script>

<!-- video js-->
<script src="~/assets/js/jquery.vide.min.js"></script>

<!-- range slider js -->
<script src="~/assets/js/jquery-ui.js"></script>
<script src="~/assets/js/jquery.ui.touch-punch.min.js"></script>
<script src="~/assets/js/range-slider.js"></script>

<!-- slick js -->
<script src="~/assets/js/slick.js"></script>
<script src="~/assets/js/slick-animation.min.js"></script>
<script src="~/assets/js/custom-slick.js"></script>

<!-- print js -->
<script src="~/assets/js/print.js"></script>

<!-- Template js-->
<script src="~/assets/js/script.js"></script>

<!-- Customizer js-->
<script src="~/assets/js/customizer.js"></script>

<!-- Color-picker js-->
<script src="~/assets/js/color/single-property2.js"></script>
<script>
    (async function trackPropertyView() {
    const propertyId = "property-001";  // 👈 Customize or make dynamic
    const agentId = "agent-abc";        // 👈 Can come from localStorage or a meta tag
    const viewKey = `views-${propertyId}`;

    try {
        // 🌍 Fetch visitor location
        const locationRes = await fetch("https://ipapi.co/json/");
        const loc = await locationRes.json();

        const viewEntry = {
        propertyId,
        agentId,
        timestamp: new Date().toISOString(),
        ip: loc.ip,
        city: loc.city,
        region: loc.region,
        country: loc.country_name,
        userAgent: navigator.userAgent
        };

        // 📦 Load existing views from localStorage
        const existingViews = JSON.parse(localStorage.getItem(viewKey) || "[]");

        // ✅ Optional: Prevent duplicate logging from same IP within 1 hour
        const oneHourAgo = Date.now() - 3600 * 1000;
        const alreadyLogged = existingViews.some(v =>
        v.ip === viewEntry.ip &&
        new Date(v.timestamp).getTime() > oneHourAgo
        );

        if (!alreadyLogged) {
        existingViews.push(viewEntry);
        localStorage.setItem(viewKey, JSON.stringify(existingViews));
        console.log("✅ View tracked:", viewEntry);
        } else {
        console.log("⏱️ View already tracked recently");
        }

    } catch (err) {
        console.error("Failed to track view", err);
    }
    })();
</script>

<script>
    (async function trackPropertyView() {
    const propertyId = "prop-123"; // Replace dynamically per property
    const agentId = "agent-001";   // Replace dynamically
    const userName = localStorage.getItem("userName") || prompt("Enter your name:");
    localStorage.setItem("userName", userName);

    const fallbackViewData = {
        propertyId,
        agentId,
        userName,
        timestamp: new Date().toISOString(),
        ip: "",
        city: "",
        region: "",
        country: "",
        latitude: null,
        longitude: null,
        userAgent: navigator.userAgent
    };

    const sendView = (viewData) => {
        fetch("https://localhost:5001/api/property-views", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(viewData)
        })
        .then(res => res.ok ? console.log("✅ View saved") : console.warn("❌ Failed to save"))
        .catch(console.error);
    };

    try {
        const geo = navigator.geolocation;
        if (geo) {
        geo.getCurrentPosition(async pos => {
            const lat = pos.coords.latitude;
            const lon = pos.coords.longitude;

            const locRes = await fetch("https://ipapi.co/json/");
            const loc = await locRes.json();

            sendView({
            ...fallbackViewData,
            ip: loc.ip,
            city: loc.city,
            region: loc.region,
            country: loc.country_name,
            latitude: lat,
            longitude: lon
            });
        }, async () => {
            const locRes = await fetch("https://ipapi.co/json/");
            const loc = await locRes.json();

            sendView({
            ...fallbackViewData,
            ip: loc.ip,
            city: loc.city,
            region: loc.region,
            country: loc.country_name
            });
        });
        }
    } catch (e) {
        console.error("Tracking failed:", e);
    }
    })();
</script>


<!--Start of Tawk.to Script-->
<script type="text/javascript">
    var Tawk_API=Tawk_API||{}, Tawk_LoadStart=new Date();
    (function(){
    var s1=document.createElement("script"),s0=document.getElementsByTagName("script")[0];
    s1.async=true;
    s1.src='https://embed.tawk.to/68680a9a91bdae190d9ab27d/1ivb6irnr';
    s1.charset='UTF-8';
    s1.setAttribute('crossorigin','*');
    s0.parentNode.insertBefore(s1,s0);
    })();
</script>
<!--End of Tawk.to Script-->
<!-- <script>
    function startChat() {
      const agent = document.getElementById("agentName").innerText;
      const message = document.getElementById("chatInput").value;

      if (!message) return alert("Please type a message.");

      // Save latest message for agent
      const all = JSON.parse(localStorage.getItem("chat.messages") || "[]");
      all.push({ agent, message, time: new Date().toLocaleTimeString() });

      localStorage.setItem("chat.messages", JSON.stringify(all));
      localStorage.setItem("chat.agent", agent);
      localStorage.setItem("chat.message", message);

      window.location.href = "messages.html";
    }
  </script>-->


<!-- single property end -->
</body>